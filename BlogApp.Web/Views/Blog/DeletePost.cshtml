@using BlogApp.Web.Models.DTOs
@{
    ViewData["Title"] = "Delete Post";
}
@model PostDTO

<div class="flex h-full w-full items-center justify-center">
    <div class="w98-border flex flex-col gap-[1rem] bg-[#C0C0C0] px-5 py-4">
        <div class="w98-row">
            <label class="w98-label" for="slug">Slug:</label>
            <input class="w98-input" id="slug" disabled value="@Model.Slug" />
        </div>
        <div class="w98-row">
            <label class="w98-label" for="admin_key">Key:</label>
            <input class="w98-input" id="admin_key" />
        </div>
        <div class="w98-fieldset mt-4 flex flex-col items-center justify-center">
            <p class="text-sm">Are you sure you want to delete this post?</p>
            <div class="mt-3">
                <button onclick="handleFormSubmit" type="submit" id="submit" class="w98-btn">OK</button>
                <button type="button" id="cancel" class="w98-btn">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelector("#submit").addEventListener("click", handleFormSubmit);
    document.querySelector("#cancel").addEventListener("click", () => window.location.href = "/");

    async function handleFormSubmit(e) {
        e.preventDefault();
        const adminKey = document.getElementById("admin_key").value;
        const slug = document.getElementById("slug").value;

        const response = await fetch(`/posts/${slug}/delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'admin_key': adminKey
            }
        })

        if (!response.ok) {
            const data = await response.text();
            let message;
            try {
                message = JSON.parse(data);
            } catch {
                message = data;
            }

            alert(message);
        } else {
            window.location.href = "/";
        }
    }
</script>